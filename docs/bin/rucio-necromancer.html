<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Running rucio-necromancer · Rucio Documentation</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="```"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Running rucio-necromancer · Rucio Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://bziemons.github.io/rucio-documentation/"/><meta property="og:description" content="```"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/rucio-documentation/img/android-chrome-512x512.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="/rucio-documentation/css/custom.css"/><link rel="stylesheet" href="/rucio-documentation/prism/prism.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,700&amp;display=swap"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:400,500,700&amp;display=swap"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code&amp;display=swap"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/rucio-documentation/prism/prism.js"></script><script src="/rucio-documentation/js/scrollSpy.js"></script><link rel="stylesheet" href="/rucio-documentation/css/main.css"/><script src="/rucio-documentation/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/rucio-documentation/"><img class="logo" src="/rucio-documentation/img/wide_logo2.png" alt="Rucio Documentation"/></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/rucio-documentation/docs/" target="_self">Docs</a></li><li class=""><a href="https://rucio.readthedocs.io/_/downloads/en/next/pdf/" target="_self">Downloads</a></li><li class=""><a href="https://arxiv.org/abs/1902.09857" target="_self">Scientific articles</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Ask me something" title="Ask me something"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Running rucio-necromancer</h1></header><article><div><span><pre><code class="hljs">usage: rucio-necromancer [-h] [<span class="hljs-params">--run-once</span>] [<span class="hljs-params">--threads</span> THREADS] [<span class="hljs-params">--bulk</span> BULK]

The Necromancer daemon is responsible for managing bad replicas. If a replica
that got declared bad has other replicas, it will <span class="hljs-keyword">try</span> to recover it by
requesting a new transfer. If there are no replicas anymore, then the file
gets marked as lost.

optional arguments:
  -h, <span class="hljs-params">--help</span>         show this <span class="hljs-keyword">help</span> message and exit
  <span class="hljs-params">--run-once</span>         Runs one loop iteration
  <span class="hljs-params">--threads</span> THREADS  Concurrency control: number of threads
  <span class="hljs-params">--bulk</span> BULK        Bulk control: number of requests per cycle

Lost replica: In this example the file gets uploaded and will only have this
replica as there are no replication rules. If it gets declared bad, there will
be no replica to recover from. Therefor the replica gets marked as lost.
Upload a file:: $ rucio upload <span class="hljs-params">--scope</span> mock <span class="hljs-params">--rse</span> MOCK <span class="hljs-params">--name</span> file
filename.txt Check replicas:: $ rucio list-file-replicas mock<span class="hljs-function">:file</span> +<span class="hljs-params">---------</span>+
<span class="hljs-params">--------</span>+<span class="hljs-params">------------</span>+<span class="hljs-params">-----------</span>+<span class="hljs-params">--------------------------------------------</span>
<span class="hljs-params">-------------</span>+ | SCOPE | NAME | FILESIZE | ADLER32 | RSE: REPLICA | |<span class="hljs-params">---------</span>
+<span class="hljs-params">--------</span>+<span class="hljs-params">------------</span>+<span class="hljs-params">-----------</span>+<span class="hljs-params">-------------------------------------------</span>
<span class="hljs-params">--------------</span>| | mock | file | 149.000 B | 948240 | MOCK:
file:<span class="hljs-string">//localhost</span><span class="hljs-function">:0</span>/tmp/rucio_rse/mock/fb/d1/file | +<span class="hljs-params">---------</span>+<span class="hljs-params">--------</span>+<span class="hljs-params">-------</span>
<span class="hljs-params">-----</span>+<span class="hljs-params">-----------</span>+<span class="hljs-params">---------------------------------------------------------</span>+
Declare it as bad:: $ rucio-admin replicas declare-bad
file:<span class="hljs-string">//localhost</span><span class="hljs-function">:0</span>/tmp/rucio_rse/mock/fb/d1/file <span class="hljs-params">--reason</span> 'bad' Run the
daemon:: $ rucio-necromancer <span class="hljs-params">--run-once</span> Check replicas again:: $ rucio list-
file-replicas mock<span class="hljs-function">:file</span>
+<span class="hljs-params">---------</span>+<span class="hljs-params">--------</span>+<span class="hljs-params">------------</span>+<span class="hljs-params">-----------</span>+<span class="hljs-params">----------------</span>+ | SCOPE | NAME
| FILESIZE | ADLER32 | RSE: REPLICA |
|<span class="hljs-params">---------</span>+<span class="hljs-params">--------</span>+<span class="hljs-params">------------</span>+<span class="hljs-params">-----------</span>+<span class="hljs-params">----------------</span>|
+<span class="hljs-params">---------</span>+<span class="hljs-params">--------</span>+<span class="hljs-params">------------</span>+<span class="hljs-params">-----------</span>+<span class="hljs-params">----------------</span>+ Bad replica: In
this example the file gets uploaded and will have two replicas. If it gets
declared bad, then the daemon will <span class="hljs-keyword">try</span> to recover it from the second replica.
Upload a file and replicate it:: $ rucio upload <span class="hljs-params">--scope</span> mock <span class="hljs-params">--rse</span> MOCK
filename.txt $ rucio add-rule mock<span class="hljs-function">:file</span> 1 MOCK2 $ rucio-conveyor-submitter
<span class="hljs-params">--run-once</span> Check replicas:: $ rucio list-file-replicas mock<span class="hljs-function">:file</span> +<span class="hljs-params">---------</span>+--
<span class="hljs-params">------</span>+<span class="hljs-params">------------</span>+<span class="hljs-params">-----------</span>+<span class="hljs-params">----------------------------------------------</span>
<span class="hljs-params">-----------</span>+ | SCOPE | NAME | FILESIZE | ADLER32 | RSE: REPLICA | |<span class="hljs-params">---------</span>+-
<span class="hljs-params">-------</span>+<span class="hljs-params">------------</span>+<span class="hljs-params">-----------</span>+<span class="hljs-params">---------------------------------------------</span>
<span class="hljs-params">------------</span>| | mock | file | 149.000 B | 948240 | MOCK:
file:<span class="hljs-string">//localhost</span><span class="hljs-function">:0</span>/tmp/rucio_rse/mock/fb/d1/file | |<span class="hljs-params">---------</span>+<span class="hljs-params">--------</span>+<span class="hljs-params">-------</span>
<span class="hljs-params">-----</span>+<span class="hljs-params">-----------</span>+<span class="hljs-params">---------------------------------------------------------</span>| |
mock | file | 149.000 B | 948240 | MOCK2:
file:<span class="hljs-string">//localhost</span><span class="hljs-function">:1</span>/tmp/rucio_rse/mock/fb/d1/file | +<span class="hljs-params">---------</span>+<span class="hljs-params">--------</span>+<span class="hljs-params">-------</span>
<span class="hljs-params">-----</span>+<span class="hljs-params">-----------</span>+<span class="hljs-params">---------------------------------------------------------</span>+
Declare one replica as bad:: $ rucio-admin replicas declare-bad
file:<span class="hljs-string">//localhost</span><span class="hljs-function">:1</span>/tmp/rucio_rse/mock/fb/d1/file <span class="hljs-params">--reason</span> 'bad' Run the
daemon:: $ rucio-necromancer <span class="hljs-params">--run-once</span> Check replicas again:: $ rucio list-
file-replicas mock<span class="hljs-function">:file</span> +<span class="hljs-params">---------</span>+<span class="hljs-params">--------</span>+<span class="hljs-params">------------</span>+<span class="hljs-params">-----------</span>+<span class="hljs-params">---------</span>
<span class="hljs-params">------------------------------------------------</span>+ | SCOPE | NAME | FILESIZE |
ADLER32 | RSE: REPLICA | |<span class="hljs-params">---------</span>+<span class="hljs-params">--------</span>+<span class="hljs-params">------------</span>+<span class="hljs-params">-----------</span>+<span class="hljs-params">--------</span>
<span class="hljs-params">-------------------------------------------------</span>| | mock | file | 149.000 B |
948240 | MOCK: file:<span class="hljs-string">//localhost</span><span class="hljs-function">:0</span>/tmp/rucio_rse/mock/fb/d1/file | |<span class="hljs-params">---------</span>+-
<span class="hljs-params">-------</span>+<span class="hljs-params">------------</span>+<span class="hljs-params">-----------</span>+<span class="hljs-params">---------------------------------------------</span>
<span class="hljs-params">------------</span>| | mock | file | 149.000 B | 948240 | MOCK2:
file:<span class="hljs-string">//localhost</span><span class="hljs-function">:1</span>/tmp/rucio_rse/mock/fb/d1/file | +<span class="hljs-params">---------</span>+<span class="hljs-params">--------</span>+<span class="hljs-params">-------</span>
<span class="hljs-params">-----</span>+<span class="hljs-params">-----------</span>+<span class="hljs-params">---------------------------------------------------------</span>+
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2021 CERN. Created with Docusaurus.</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '04e5d623b96121df11ac440e51fc8956',
                indexName: 'rucio-cern',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>